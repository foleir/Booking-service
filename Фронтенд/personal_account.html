<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="profile-page">
    <div class="dashboard-container">
        <!-- Левое меню -->
        <div class="sidebar">
            <h2>Личный кабинет</h2>
            <ul>
                <li><a href="#" id="profile-btn" class="active">Профиль</a></li>
                <li><a href="#" id="equipment-btn">Мое оборудование</a></li>
                <li><a href="#" id="favorites-btn">Избранное</a></li>
            </ul>
            <a href="#" class="logout-btn" id="logout-btn">Выход</a>
        </div>

        <!-- Основное содержимое -->
        <div class="content">
            <!-- Профиль -->
            <div id="profile" class="tab-content active">
                <h3 class="profile-title">Редактирование профиля</h3>
                <form id="profile-form">
                    <div class="form-group">
                        <label for="username"><strong>Логин:</strong></label>
                        <input type="text" id="username" name="username" value="user123" required>
                    </div>
                
                    <div class="form-group password-input">
                        <label for="password"><strong>Пароль:</strong></label>
                        <input type="password" id="password" name="password" value="********" required>
                        <button type="button" class="password-toggle">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                
                    <div class="form-group">
                        <label for="firstname"><strong>Имя:</strong></label>
                        <input type="text" id="firstname" name="firstname" value="Иван" required>
                    </div>
                
                    <div class="form-group">
                        <label for="lastname"><strong>Фамилия:</strong></label>
                        <input type="text" id="lastname" name="lastname" value="Иванов" required>
                    </div>
                
                    <div class="form-group">
                        <label for="role"><strong>Уровень полномочий:</strong></label>
                        <select id="role" name="role" disabled>
                            <option value="student" selected>Студент (Только просмотр)</option>
                            <option value="teacher">Преподаватель (Бронирование/отмена)</option>
                            <option value="admin">Администратор (Все права)</option>
                        </select>
                    </div>
                </form>
            </div>

            <!-- Оборудование -->
            <div id="equipment" class="tab-content">
                <h3 class="equipment-title">Мое оборудование</h3>
                <div class="equipment-list">
                  
                  <div class="equipment-item" data-url="/equipment/1">
                    <img src="https://via.placeholder.com/60" alt="Оборудование" class="equipment-image">
                    <div class="equipment-name">Название оборудования + серия</div>
                    <div class="equipment-status active">
                      Статус: Активный <span class="status-light green"></span>
                    </div>
                  </div> 
                  
                  <div class="equipment-item" data-url="/equipment/2">
                    <img src="https://via.placeholder.com/60" alt="Оборудование" class="equipment-image">
                    <div class="equipment-name">Название оборудования + серия</div>
                    <div class="equipment-status booked">
                      Статус: 10.05.2024 - 12.05.2024 <span class="status-light red"></span>
                    </div>
                  </div>
                  
                </div>
            </div>
              

            <!-- Избранное -->
            <div id="favorites" class="tab-content">
                <h3 class="favorites-title">Избранное</h3>
                <div class="favorites-list">
                  <div class="favorite-item" data-url="/equipment/1">
                    <div class="favorite-content">
                      <img src="https://via.placeholder.com/60" alt="Оборудование" class="equipment-image">
                      <div class="equipment-name">Название оборудования + серия</div>
                    </div>
                    <button class="favorite-toggle active" data-id="1"><i class="fas fa-heart"></i></button>
                  </div>
              
                  <div class="favorite-item" data-url="/equipment/2">
                    <div class="favorite-content">
                      <img src="https://via.placeholder.com/60" alt="Оборудование" class="equipment-image">
                      <div class="equipment-name">Название оборудования + серия</div>
                    </div>
                    <button class="favorite-toggle active" data-id="2"><i class="fas fa-heart"></i></button>
                  </div>
                </div>
            </div> 

    <!-- Бургер-меню в правом верхнем углу -->
    <button class="menu-toggle" id="menu-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Модальное окно подтверждения выхода -->
    <div id="logout-modal" class="modal">
        <div class="modal-content">
            <p>Вы уверены, что хотите выйти из аккаунта?</p>
            <div class="modal-buttons">
                <button id="confirm-logout">Да, выйти</button>
                <button id="cancel-logout">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно подтверждения изменений -->
    <div id="change-confirm-modal" class="modal">
        <div class="modal-content">
            <p id="change-confirm-message">Вы действительно хотите внести изменения?</p>
            <div class="modal-buttons">
                <button id="confirm-change">Да, изменить</button>
                <button id="cancel-change">Отмена</button>
            </div>
        </div>
    </div>

    <script>
        // Переключение вкладок
        document.getElementById('profile-btn').addEventListener('click', function(e) {
            e.preventDefault();
            switchTab('profile');
        });

        document.getElementById('equipment-btn').addEventListener('click', function(e) {
            e.preventDefault();
            switchTab('equipment');
        });

        document.getElementById('favorites-btn').addEventListener('click', function(e) {
            e.preventDefault();
            switchTab('favorites');
        });

        function switchTab(tabId) {
            // Скрыть все вкладки
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Показать выбранную вкладку
            document.getElementById(tabId).classList.add('active');
            
            // Обновить активное состояние в меню
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(tabId + '-btn').classList.add('active');
        }

        // Подтверждение изменений для всех полей
        const profileForm = document.getElementById('profile-form');
        const usernameInput = document.getElementById('username');
        const firstnameInput = document.getElementById('firstname');
        const lastnameInput = document.getElementById('lastname');
        const passwordInput = document.getElementById('password');
        
        // Сохраняем исходные значения
        const originalValues = {
            username: usernameInput.value,
            firstname: firstnameInput.value,
            lastname: lastnameInput.value,
            password: passwordInput.value
        };
        
        // Модальное окно подтверждения изменений
        const changeConfirmModal = document.getElementById('change-confirm-modal');
        const changeConfirmMessage = document.getElementById('change-confirm-message');
        const confirmChangeBtn = document.getElementById('confirm-change');
        const cancelChangeBtn = document.getElementById('cancel-change');
        
        let currentChangingField = null;
        let currentOriginalValue = '';
        let currentFieldName = '';
        
        // Функция для проверки изменений
        function checkChanges(inputElement, fieldName, displayName) {
            if (inputElement.value !== originalValues[fieldName]) {
                currentChangingField = inputElement;
                currentOriginalValue = originalValues[fieldName];
                currentFieldName = fieldName;
                
                changeConfirmMessage.textContent = `Вы действительно хотите изменить ${displayName} с "${originalValues[fieldName]}" на "${inputElement.value}"?`;
                changeConfirmModal.style.display = 'flex';
                
                return true;
            }
            return false;
        }
        
        // Обработчики для полей ввода
        usernameInput.addEventListener('blur', function() {
            checkChanges(this, 'username', 'логин');
        });
        
        firstnameInput.addEventListener('blur', function() {
            checkChanges(this, 'firstname', 'имя');
        });
        
        lastnameInput.addEventListener('blur', function() {
            checkChanges(this, 'lastname', 'фамилию');
        });
        
        passwordInput.addEventListener('blur', function() {
            if (this.value !== originalValues.password && this.value !== '********') {
                currentChangingField = this;
                currentOriginalValue = originalValues.password;
                currentFieldName = 'password';
                
                changeConfirmMessage.textContent = 'Вы действительно хотите изменить пароль?';
                changeConfirmModal.style.display = 'flex';
            }
        });
        
        // Подтверждение изменения
        confirmChangeBtn.addEventListener('click', function() {
            // Обновляем оригинальное значение
            originalValues[currentFieldName] = currentChangingField.value;
            
            // Здесь можно добавить AJAX-запрос для сохранения данных
            console.log('Изменения сохранены:', originalValues);
            
            changeConfirmModal.style.display = 'none';
            currentChangingField = null;
        });
        
        // Отмена изменения
        cancelChangeBtn.addEventListener('click', function() {
            if (currentChangingField) {
                currentChangingField.value = currentOriginalValue;
            }
            changeConfirmModal.style.display = 'none';
            currentChangingField = null;
        });

        // Переключение видимости пароля
        document.querySelector('.password-toggle').addEventListener('click', function() {
            const input = this.parentElement.querySelector('input');
            const eyeIcon = this.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                input.type = 'password';
                eyeIcon.classList.replace('fa-eye-slash', 'fa-eye');
            }
        });

        // Бургер-меню - переход на главную
        document.getElementById('menu-toggle').addEventListener('click', function() {
            window.location.href = 'index.html';
        });

        // Подтверждение выхода
        const logoutBtn = document.getElementById('logout-btn');
        const logoutModal = document.getElementById('logout-modal');
        const confirmLogout = document.getElementById('confirm-logout');
        const cancelLogout = document.getElementById('cancel-logout');

        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            logoutModal.style.display = 'flex';
        });

        confirmLogout.addEventListener('click', function() {
            window.location.href = 'index.html';
        });

        cancelLogout.addEventListener('click', function() {
            logoutModal.style.display = 'none';
        });

        // Закрытие модальных окон при клике вне их
        window.addEventListener('click', function(event) {
            if (event.target === logoutModal) {
                logoutModal.style.display = 'none';
            }
            if (event.target === changeConfirmModal) {
                if (currentChangingField) {
                    currentChangingField.value = currentOriginalValue;
                }
                changeConfirmModal.style.display = 'none';
                currentChangingField = null;
            }
        });

        // Обработчик для перехода по оборудованию в разделе "Мое оборудование"
        document.querySelectorAll('.equipment-item[data-url]').forEach(item => {
            item.addEventListener('click', function(e) {
                // Проверяем, не был ли клик по статусу оборудования
                if (!e.target.closest('.equipment-status')) {
                    const url = item.getAttribute('data-url');
                    if (url) {
                        window.location.href = url;
                    }
                }
            });
        });

         // Обработчик для кнопок избранного
         document.querySelectorAll('.favorite-toggle').forEach(button => {
            button.addEventListener('click', function(e) {
                e.stopPropagation();
                
                const item = this.closest('.favorite-item');
                if (this.classList.contains('active')) {
                    this.classList.remove('active');
                    this.querySelector('i').style.color = 'gray';
                    
                    const equipmentId = this.getAttribute('data-id');
                    console.log('Удалено из избранного:', equipmentId);
                    
                    setTimeout(() => {
                        item.remove();
                    }, 300);
                }
            });
        });

        // Обработчик для перехода по оборудованию в избранном
        document.querySelectorAll('.favorite-item[data-url]').forEach(item => {
            item.addEventListener('click', function(e) {
                if (!e.target.closest('.favorite-toggle')) {
                    const url = item.getAttribute('data-url');
                    if (url) {
                        window.location.href = url;
                    }
                }
            });
        });

    document.querySelectorAll('.favorite-item[data-url]').forEach(item => {
        item.style.cursor = 'pointer'; // чтобы курсор менялся на руку

        item.addEventListener('click', e => {
            // Если кликнули именно по кнопке сердечка — перехода не делаем
            if (e.target.closest('.favorite-toggle')) return;

            const url = item.getAttribute('data-url');
            if (url) {
                window.location.href = url;
            }
        });
    });

    </script>
</body>
</html>
